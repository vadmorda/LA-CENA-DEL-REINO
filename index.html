<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Banquete de los Tres Estamentos ‚Äî Sala del Vasallaje</title>
  <meta name="mobile-web-app-capable" content="yes" />
  <style>
    :root{ --bg:#0b0f17; --wood:#5b3a1e; --gold:#d4af37; --parch:#f3e6c5; --ink:#2a2417; --red:#b33a3a; --green:#2f8f46; --blue:#2b67b6; }
    *{box-sizing:border-box} html,body{height:100%;margin:0}
    body{ background: radial-gradient(1200px 600px at 70% -10%, #1a2335 0%, var(--bg) 60%); color:#eee; font-family:"Press Start 2P",system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial,monospace; image-rendering:pixelated; overflow:hidden }
    .crt::after{ content:"";position:fixed;inset:0;pointer-events:none;opacity:.2;mix-blend-mode:multiply; background:linear-gradient(rgba(0,0,0,.25),rgba(0,0,0,.25)),repeating-linear-gradient(to bottom, rgba(255,255,255,.04) 0 2px, rgba(0,0,0,.06) 2px 4px) }
    .wrap{max-width:1100px;margin:0 auto;padding:16px;height:100%;display:flex;flex-direction:column;gap:12px}
    h1{font-size:20px;letter-spacing:1px;margin:0;color:#fff;text-shadow:0 2px 0 #000} .subtitle{font-size:12px;color:#cbd5e1;opacity:.9}
    .board{flex:1;display:grid;grid-template-columns:280px 1fr;gap:14px;min-height:0}
    .scroll{background:linear-gradient(180deg,#f7ecd1,#e9dbb4); color:var(--ink); border:3px solid #a8843a; border-radius:12px; padding:14px; position:relative; box-shadow:0 10px 0 #0004 inset,0 6px 16px rgba(0,0,0,.45)}
    .scroll h2{font-size:14px;margin:0 0 10px 0;} .scroll p,.scroll li{font-size:12px;line-height:1.55} .scroll ul{padding-left:18px;margin:8px 0} .scroll .hint{margin-top:8px;padding:8px;border:2px dashed #a8843a;border-radius:8px;background:#f6efda}
    .hall{ background: conic-gradient(from 180deg at 50% -20%, #0f1625, #0a0f1b 65% 100%); border:2px solid #0a101c; border-radius:14px; padding:12px; position:relative; box-shadow: inset 0 0 40px rgba(0,0,0,.6); display:flex; flex-direction:column; gap:10px; overflow:hidden }
    .table{ margin:0 auto; width:100%; max-width:720px; aspect-ratio:16/5; position:relative; background: radial-gradient(80% 120% at 50% -20%, #6b4725 0%, #4b2f16 60%, #2d1b0a 100%); border:6px solid #2e1b0b; border-radius:10px; box-shadow:0 10px 0 #0006 }
    .table::before{ content:""; position:absolute; inset:10% 4%; border-radius:8px; background: repeating-linear-gradient(45deg,#f0d7a8 0 10px,#e8cf9e 10px 20px); filter:contrast(1.1) saturate(0.9) }
    .seats{ position:absolute; inset:8% 4%; display:grid; grid-template-columns:repeat(5,1fr); gap:6px; align-items:end }
    .seat{ position:relative; height:100%; min-height:90px; border:2px dashed rgba(255,255,255,.25); border-radius:8px; display:flex; align-items:center; justify-content:center; padding:6px; transition:.15s }
    .seat[data-label]::after{ content:attr(data-label); position:absolute; bottom:4px; left:50%; transform:translateX(-50%); font-size:10px; color:#eee; opacity:.7 }
    .seat.occupied{ border-style:solid; border-color:#96eaa6 }
    .tray{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:center; padding:10px; border:2px dashed #334155; border-radius:10px; background:#0e1627 }
    .token{ width:88px; height:100px; user-select:none; cursor:grab; position:relative; display:flex; align-items:end; justify-content:center } .token:active{cursor:grabbing}
    .sprite{ width:80px; height:80px; image-rendering:pixelated; filter:drop-shadow(0 2px 0 #000) drop-shadow(0 6px 8px rgba(0,0,0,.4)) }
    .label{ position:absolute; top:-6px; left:50%; transform:translateX(-50%); font-size:10px; padding:2px 6px; border-radius:8px; background:#0009; color:#fff }
    .actions{ display:flex; gap:8px; justify-content:center; flex-wrap:wrap }
    button{ font-family:inherit; font-size:12px; padding:10px 14px; border-radius:10px; border:0; background:#1e293b; color:#fff; box-shadow:0 4px 0 #0b1220; cursor:pointer }
    button:hover{ transform:translateY(-1px) } button:active{ transform:translateY(1px) }
    .primary{ background:linear-gradient(180deg,#2b67b6,#1b4a89) } .success{background:linear-gradient(180deg,#3da45b,#2b7b43)} .danger{background:linear-gradient(180deg,#b33a3a,#7a2424)}
    .gate{position:fixed; inset:0; background:radial-gradient(70% 60% at 50% 40%, rgba(0,0,0,.75), rgba(0,0,0,.95) 60% 100%); display:flex; align-items:center; justify-content:center; z-index:40}
    .gate .panel{ width:min(600px,92vw); background:linear-gradient(180deg,#f7ecd1,#e9dbb4); color:var(--ink); border:6px solid #2e1b0b; border-radius:12px; padding:18px; box-shadow:0 18px 0 #0005, 0 10px 24px rgba(0,0,0,.6); text-align:center }
    .panel h2{margin:0 0 6px 0;font-size:16px} .panel p{margin:6px 0 14px 0;font-size:12px}
    .panel input{width:100%; padding:12px; font-family:inherit; font-size:14px; border:2px solid #9a7b32; border-radius:10px; text-align:center; background:#fffdf5}
    .panel .msg{font-size:12px; color:#7a2424; min-height:1.2em; margin-top:6px}
    .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.75); z-index:30 }
    .modal .card{ width:min(640px,92vw); background:linear-gradient(180deg,#f7ecd1,#e9dbb4); color:var(--ink); border:5px solid #a8843a; border-radius:12px; padding:16px; text-align:center }
    .modal h3{margin:0 0 8px 0; font-size:16px} .modal p{font-size:12px;}
    .footer{font-size:10px; color:#cbd5e1; opacity:.75; text-align:center}
    .sr{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body class="crt">
  <div class="wrap">
    <header>
      <h1>Banquete de los Tres Estamentos</h1>
      <div class="subtitle">Sala del Vasallaje ¬∑ Puzzle estilo retro ¬∑ Arrastra y suelta</div>
    </header>

    <main class="board" aria-live="polite">
      <aside class="scroll">
        <h2>Reglas del banquete</h2>
        <p>Coloca a los cinco personajes en la mesa‚Ä¶</p>
      </aside>

      <section class="hall">
        <div class="table">
          <div class="seats">
            <div class="seat" data-label="Asiento 1"></div>
            <div class="seat" data-label="Asiento 2"></div>
            <div class="seat" data-label="Asiento 3"></div>
            <div class="seat" data-label="Asiento 4"></div>
            <div class="seat" data-label="Asiento 5"></div>
          </div>
        </div>

        <div class="tray">
          <div class="token" draggable="true" data-role="Rey"><span class="label">Rey</span></div>
          <div class="token" draggable="true" data-role="Cl√©rigo"><span class="label">Cl√©rigo</span></div>
          <div class="token" draggable="true" data-role="Noble"><span class="label">Noble</span></div>
          <div class="token" draggable="true" data-role="Caballero"><span class="label">Caballero</span></div>
          <div class="token" draggable="true" data-role="Campesino"><span class="label">Campesino</span></div>
        </div>

        <div class="actions">
          <button class="primary" id="checkBtn" disabled>Comprobar</button>
          <button class="danger" id="resetBtn">Reiniciar</button>
        </div>
      </section>
    </main>
  </div>

  <div class="gate" id="gate">
    <div class="panel">
      <h2>CURIA requerida</h2>
      <p>Introduce la palabra encontrada en el enigma anterior.</p>
      <input id="passInput" type="password" placeholder="Introduce la palabra‚Ä¶" />
      <div class="msg" id="gateMsg"></div>
      <button class="primary" id="unlockBtn">Entrar</button>
    </div>
  </div>

  <div class="modal" id="winModal">
    <div class="card">
      <h3>¬°Enhorabuena! üèÜ</h3>
      <p id="winText"></p>
      <button class="success" id="closeWin">Continuar</button>
    </div>
  </div>

  <script>
  (function(){
    const SOL_SLOTS=["Campesino","Caballero","Noble","Rey","Cl√©rigo"];
    const NEXT_CLUE="PISTA: La llave dorada est√° bajo la copa del cl√©rigo.";

    const gate=document.getElementById("gate");
    const input=document.getElementById("passInput");
    const msg=document.getElementById("gateMsg");
    const unlock=document.getElementById("unlockBtn");
    const check=document.getElementById("checkBtn");

    function unlockGate(){
      const val=input.value.trim().toLowerCase();
      if(val==="curia"){gate.style.display="none";check.focus();}
      else{msg.textContent="Contrase√±a incorrecta";input.value="";}
    }
    unlock.onclick=unlockGate;
    input.onkeydown=e=>{if(e.key==="Enter")unlockGate();};

    // Drag & drop
    const seats=[...document.querySelectorAll(".seat")];
    const tray=document.querySelector(".tray");
    let drag=null;

    document.querySelectorAll(".token").forEach(tok=>{
      tok.addEventListener("dragstart",e=>{drag=tok;e.dataTransfer.effectAllowed="move";});
      tok.addEventListener("dragend",()=>{drag=null;});
    });
    [tray,...seats].forEach(z=>{
      z.addEventListener("dragover",e=>{e.preventDefault();});
      z.addEventListener("drop",e=>{
        e.preventDefault();
        if(!drag)return;
        if(z.classList.contains("seat")){
          if(z.firstChild)tray.appendChild(z.firstChild);
          z.appendChild(drag);
        }else tray.appendChild(drag);
        update();
      });
    });

    const reset=document.getElementById("resetBtn");
    reset.onclick=()=>{seats.forEach(s=>{if(s.firstChild)tray.appendChild(s.firstChild)});update();};

    function update(){
      seats.forEach(s=>s.classList.toggle("occupied",!!s.firstChild));
      check.disabled=seats.filter(s=>s.firstChild).length!==5;
    }

    check.onclick=()=>{
      const arr=seats.map(s=>s.firstChild?.dataset.role||null);
      if(JSON.stringify(arr)===JSON.stringify(SOL_SLOTS)){
        document.getElementById("winText").textContent=NEXT_CLUE;
        document.getElementById("winModal").style.display="flex";
      }else alert("Algo no cuadra...");
    };

    document.getElementById("closeWin").onclick=()=>document.getElementById("winModal").style.display="none";
  })();
  </script>
</body>
</html>
